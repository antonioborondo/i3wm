#!/bin/bash

if [ "$#" -ne 1 ]
then
    echo "Usage: $0 output"
    exit 2
fi

info=$(xrandr | grep -A 1 --no-group-separator $1)

resolution_x_in_pixels=$(echo $info | sed -nr "s/^.*\s([0-9]+)x[0-9]+\s+[0-9]+\.[0-9]+(\*|\s)\+$/\1/p")

resolution_y_in_pixels=$(echo $info | sed -nr "s/^.*\s[0-9]+x([0-9]+)\s+[0-9]+\.[0-9]+(\*|\s)\+$/\1/p")

size_x_in_mm=$(echo $info | sed -nr "s/^.*\s([0-9]+)mm\sx\s[0-9]+mm\s.*$/\1/p")
if [ "$size_x_in_mm" == "" ]
then
    exit 1
fi

size_y_in_mm=$(echo $info | sed -nr "s/^.*\s[0-9]+mm\sx\s([0-9]+)mm\s.*$/\1/p")
if [ "$size_y_in_mm" == "" ]
then
    exit 1
fi

size_x_in_cm=$(echo 2k $size_x_in_mm 10 / p | dc)
size_x_in_in=$(echo 2k $size_x_in_cm 2.54 / p | dc)

dpi_x=$(echo $resolution_x_in_pixels $size_x_in_in / p | dc)

size_y_in_cm=$(echo 2k $size_y_in_mm 10 / p | dc)
size_y_in_in=$(echo 2k $size_y_in_cm 2.54 / p | dc)

dpi_y=$(echo $resolution_y_in_pixels $size_y_in_in / p | dc)

echo $(($dpi_x < $dpi_y ? $dpi_x : $dpi_y))

exit 0
